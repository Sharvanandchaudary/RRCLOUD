<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend APIs</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .success { color: green; }
        .error { color: red; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Frontend API Testing Tool</h1>
        
        <div class="section">
            <h2>üîê Step 1: Login (Get Token)</h2>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="loginEmail" value="admin@zgenai.com">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="loginPassword" value="admin123">
            </div>
            <button onclick="testLogin()">Login</button>
            <div id="loginResult"></div>
        </div>

        <div class="section">
            <h2>üë§ Step 2: Create User</h2>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="userName" value="Test User Frontend">
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="userEmail" value="testfrontend@example.com">
            </div>
            <div class="form-group">
                <label>Phone:</label>
                <input type="text" id="userPhone" value="555-1234">
            </div>
            <div class="form-group">
                <label>Role:</label>
                <select id="userRole">
                    <option value="student">Student</option>
                    <option value="trainer">Trainer</option>
                    <option value="recruiter">Recruiter</option>
                </select>
            </div>
            <button onclick="testCreateUser()">Create User</button>
            <div id="createUserResult"></div>
        </div>

        <div class="section">
            <h2>üìã Step 3: Create Assignment</h2>
            <div class="form-group">
                <label>Student ID:</label>
                <input type="number" id="studentId" value="2">
            </div>
            <div class="form-group">
                <label>Assigned User ID:</label>
                <input type="number" id="assignedUserId" value="1">
            </div>
            <div class="form-group">
                <label>Assigned User Role:</label>
                <select id="assignedUserRole">
                    <option value="trainer">Trainer</option>
                    <option value="recruiter">Recruiter</option>
                </select>
            </div>
            <button onclick="testCreateAssignment()">Create Assignment</button>
            <div id="createAssignmentResult"></div>
        </div>

        <div class="section">
            <h2>üìä Results</h2>
            <div id="allResults"></div>
        </div>
    </div>

    <script>
        let authToken = null;
        const backendUrl = 'http://localhost:8080';

        async function testLogin() {
            try {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                const response = await fetch(`${backendUrl}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const result = await response.json();
                
                if (response.ok && result.token) {
                    authToken = result.token;
                    document.getElementById('loginResult').innerHTML = 
                        `<div class="success">‚úÖ Login successful!<br>Token: ${authToken.substring(0, 30)}...</div>`;
                } else {
                    document.getElementById('loginResult').innerHTML = 
                        `<div class="error">‚ùå Login failed: ${result.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                document.getElementById('loginResult').innerHTML = 
                    `<div class="error">‚ùå Login error: ${error.message}</div>`;
            }
        }

        async function testCreateUser() {
            if (!authToken) {
                alert('Please login first to get authentication token!');
                return;
            }

            try {
                const userData = {
                    name: document.getElementById('userName').value,
                    email: document.getElementById('userEmail').value,
                    phone: document.getElementById('userPhone').value,
                    role: document.getElementById('userRole').value
                };

                const response = await fetch(`${backendUrl}/api/users`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(userData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('createUserResult').innerHTML = 
                        `<div class="success">‚úÖ User created successfully!<br>ID: ${result.user?.id}<br>Email: ${result.user?.email}</div>`;
                } else {
                    document.getElementById('createUserResult').innerHTML = 
                        `<div class="error">‚ùå User creation failed: ${result.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                document.getElementById('createUserResult').innerHTML = 
                    `<div class="error">‚ùå User creation error: ${error.message}</div>`;
            }
        }

        async function testCreateAssignment() {
            if (!authToken) {
                alert('Please login first to get authentication token!');
                return;
            }

            try {
                const assignmentData = {
                    student_id: document.getElementById('studentId').value,
                    assigned_user_id: document.getElementById('assignedUserId').value,
                    assigned_user_role: document.getElementById('assignedUserRole').value
                };

                const response = await fetch(`${backendUrl}/api/assignments`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(assignmentData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('createAssignmentResult').innerHTML = 
                        `<div class="success">‚úÖ Assignment created successfully!<br>Student ID: ${assignmentData.student_id}<br>Assigned to: ${assignmentData.assigned_user_role} (ID: ${assignmentData.assigned_user_id})</div>`;
                } else {
                    document.getElementById('createAssignmentResult').innerHTML = 
                        `<div class="error">‚ùå Assignment creation failed: ${result.error || 'Unknown error'}</div>`;
                }
            } catch (error) {
                document.getElementById('createAssignmentResult').innerHTML = 
                    `<div class="error">‚ùå Assignment creation error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>